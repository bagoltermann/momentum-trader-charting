# ============================================================================
# LLM Signal Validation Prompts Configuration
# ============================================================================
# Version: 1.0.0
# Last Updated: 2026-01-22
#
# This file contains LLM prompts for real-time signal validation.
# Edit these prompts to tune validation behavior without code changes.
#
# Used by: backend/services/llm_validator.py
# Model: qwen2.5:7b (via Ollama, same as momentum-trader)
# ============================================================================

validation:
  # System prompt sets the LLM's role and persona
  system_prompt: |
    You are a Warrior Trading strategy validator analyzing momentum stock setups.

    Your role is to validate whether a stock setup is ready for entry RIGHT NOW:
    1. Check entry timing (VWAP zone, time of day, signal freshness)
    2. Confirm momentum (volume, timeframe alignment)
    3. Assess risk/reward ratio (entry vs stop vs target)
    4. Identify any red flags that would prevent entry

    Key Warrior Trading principles:
    - Best entries are near VWAP (GREEN zone <2.5%)
    - Volume must confirm the move (5x+ ideal)
    - First hour has best momentum (9:30-10:30 AM)
    - Risk/reward must be at least 2:1
    - Exit signals should NOT already be triggered

    Output format: Valid JSON only, no markdown formatting.

  # JSON schema the LLM should output
  json_schema: |
    {
      "signal": "<buy|wait|no_trade>",
      "entry_price": <suggested entry price or null>,
      "stop_price": <stop loss price or null>,
      "target_price": <profit target price or null>,
      "confidence": <0-100 integer>,
      "reasoning": ["<reason 1>", "<reason 2>", "<reason 3>"],
      "risk_reward_ratio": <R:R ratio like 2.5 or null>,
      "key_concern": "<primary risk factor or null>"
    }

  # Signal decision guidelines
  signal_guidelines: |
    SIGNAL DECISION GUIDELINES:

    BUY signal when:
    - 5 Pillars score >= 4.0
    - VWAP zone is GREEN or YELLOW (not RED)
    - Volume ratio >= 5x
    - Timeframes mostly aligned (3+ bullish)
    - No exit signals triggered
    - Risk/reward >= 2:1
    - First 2 hours of market (before 11:30 AM)

    WAIT signal when:
    - Setup is good but timing is off
    - Price extended from VWAP (YELLOW zone) - wait for pullback
    - Volume declining - wait for confirmation
    - Exit signals showing CAUTION
    - Mid-day (11:30 AM - 1:00 PM) - wait for clarity

    NO_TRADE signal when:
    - 5 Pillars score < 3.5
    - VWAP zone is RED (chase territory)
    - Volume ratio < 3x
    - Exit signals already triggered
    - Float too large (>50M)
    - Late in day (after 3:00 PM for new entries)
    - Risk/reward < 1.5:1

  # Entry timing guidelines
  timing_guidelines: |
    ENTRY TIMING GUIDELINES:

    Time Windows:
    - PRIME TIME (9:30-10:30 AM): Best momentum, most setups work
    - MORNING (10:30-11:30 AM): Still good, be more selective
    - LUNCH (11:30 AM-1:00 PM): Typically slow, WAIT for clarity
    - AFTERNOON (1:00-3:00 PM): Watch for reversals
    - POWER HOUR (3:00-4:00 PM): Quick moves, NO new entries

    Signal Freshness:
    - FRESH (Day 0 gap): Highest priority
    - DAY 2 (Continuation): Valid if holding key levels
    - DAY 3+: Be very selective, momentum fading

    VWAP Zones:
    - GREEN (<2.5% from VWAP): Ideal entry zone
    - YELLOW (2.5-3.5%): Acceptable but elevated risk
    - RED (>3.5%): Chase territory, WAIT for pullback

  # Risk/reward guidelines
  risk_guidelines: |
    RISK/REWARD GUIDELINES:

    Entry Price:
    - Ideal: Near VWAP or at support level
    - Acceptable: At micro-pullback consolidation breakout
    - Avoid: Extended from VWAP with no support nearby

    Stop Placement:
    - Below VWAP (for VWAP entries)
    - Below consolidation low (for breakout entries)
    - Maximum 5% from entry (risk management)

    Target Setting:
    - target_1: 2R (2x risk from entry)
    - target_2: 3R (3x risk from entry)
    - Use resistance levels if closer than R targets

    Minimum Requirements:
    - Risk/reward >= 2:1 for BUY signal
    - Risk/reward >= 1.5:1 for WAIT signal
    - Below 1.5:1 = NO_TRADE

  # Confidence scoring guidelines
  confidence_guidelines: |
    CONFIDENCE SCORING (0-100):

    90-100: Perfect setup
    - All 5 Pillars pass
    - GREEN VWAP zone
    - 10x+ volume
    - All timeframes aligned
    - Strong catalyst
    - First hour of trading

    70-89: Strong setup
    - 4+ Pillars pass
    - GREEN/YELLOW VWAP zone
    - 5x+ volume
    - Most timeframes aligned
    - Known catalyst

    50-69: Acceptable setup
    - 3.5+ Pillars
    - YELLOW VWAP zone
    - 3x+ volume
    - Mixed timeframe alignment
    - Catalyst present but not definitive

    30-49: Weak setup (WAIT or NO_TRADE)
    - Some concerns present
    - Extended from VWAP
    - Volume declining
    - Late in session

    0-29: Poor setup (NO_TRADE)
    - Multiple red flags
    - Exit signals triggered
    - Float too large
    - No clear catalyst

# User prompt template with variable substitution
user_prompt_template: |
  ## SETUP OVERVIEW

  **Symbol:** {symbol}
  **Current Price:** ${price}
  **Day High:** ${high}
  **Gap:** {gap_percent}%
  **Quality Score:** {quality_score}/5

  ## 5 PILLARS ASSESSMENT

  | Pillar | Status | Value |
  |--------|--------|-------|
  | Gap 10%+ | {pillar_gap} | {gap_percent}% |
  | Volume 5x+ | {pillar_volume} | {volume_ratio}x |
  | Float <20M | {pillar_float} | {float_formatted} |
  | Price $2-$20 | {pillar_price} | ${price} |
  | Catalyst | {pillar_catalyst} | {catalyst_type} |

  **5 Pillars Score:** {pillars_score}/5

  ## ENTRY TIMING

  **Time:** {current_time} ET ({minutes_since_open} min since open)
  **Signal Freshness:** {signal_freshness}
  **Gap Age:** Day {gap_age_days}

  ### VWAP Analysis
  - **VWAP:** ${vwap}
  - **Distance from VWAP:** {vwap_distance_percent}%
  - **VWAP Zone:** {vwap_zone}
  - **Chase Risk:** {chase_risk_assessment}

  ### Moving Averages
  - **EMA 9:** ${ema9} (price {ema9_position})
  - **EMA 20:** ${ema20} (price {ema20_position})
  - **Trend:** {ema_trend}

  ## SUPPORT & RESISTANCE

  **Nearest Resistance:** ${resistance_1} ({resistance_1_strength})
  **Nearest Support:** ${support_1} ({support_1_strength})

  ## VOLUME CONFIRMATION

  - **Volume Ratio:** {volume_ratio}x average
  - **Volume Trend:** {volume_trend}
  - **Float Rotation:** {float_rotation_percent}%

  ## TIMEFRAME ALIGNMENT

  | Timeframe | Bias |
  |-----------|------|
  | 1-minute | {tf_1m_bias} |
  | 5-minute | {tf_5m_bias} |
  | 15-minute | {tf_15m_bias} |
  | Daily | {tf_daily_bias} |

  **Alignment:** {timeframe_alignment} ({aligned_count}/4 bullish)

  ## CATALYST

  **Type:** {catalyst_type}
  **Strength:** {catalyst_strength}/10
  **Definitive:** {has_definitive_catalyst}
  **Details:** {catalyst_details}

  ## RUNNER STATUS

  {runner_section}

  ## PATTERN DETECTION

  - **Micro-Pullback:** {micro_pullback_detected}
  - **Flag/Pennant:** {flag_pattern_detected}
  - **Unfilled Gaps:** {unfilled_gaps}

  ## EXIT SIGNAL STATUS

  | Signal | Status |
  |--------|--------|
  | MACD | {exit_macd} |
  | Volume Decline | {exit_volume} |
  | Jackknife | {exit_jackknife} |

  **Overall:** {exit_overall}

  ## RISK/REWARD

  - **Entry Zone:** ${entry_zone_price}
  - **Stop Zone:** ${stop_zone_price}
  - **Risk:** ${risk_dollars} ({risk_percent}%)
  - **2R Target:** ${target_2r}
  - **3R Target:** ${target_3r}

  ---

  Based on Warrior Trading methodology, validate this setup and provide your signal recommendation as JSON.

# Fallback values when LLM is unavailable
fallback:
  signal: "wait"
  confidence: 0
  reasoning:
    - "LLM validation unavailable"
    - "Manual review recommended"
  key_concern: "Unable to validate - proceed with caution"
